ç”¨æˆ·:é€šè¿‡APIè°ƒç”¨å¤§æ¨¡å‹èƒ½åƒç½‘é¡µä¸­é‚£æ ·æœ‰æµå¼è¾“å‡ºå—ï¼Ÿå¦‚æœå¯ä»¥ï¼Œåº”è¯¥æ€æ ·æ‰èƒ½åšåˆ°ï¼Ÿ

AI:é€šè¿‡APIè°ƒç”¨å¤§æ¨¡å‹æ—¶ï¼Œ**å¯ä»¥å®ç°ç±»ä¼¼ç½‘é¡µçš„æµå¼è¾“å‡º**ï¼ˆé€è¯æˆ–åˆ†å—è¿”å›ç»“æœï¼‰ã€‚ä¸»æµå¤§æ¨¡å‹APIï¼ˆå¦‚OpenAIã€Google PaLMã€Anthropic Claudeç­‰ï¼‰å‡æ”¯æŒæ­¤åŠŸèƒ½ã€‚ä»¥ä¸‹æ˜¯å®ç°æµå¼è¾“å‡ºçš„å…³é”®æ­¥éª¤å’ŒæŠ€æœ¯ç»†èŠ‚ï¼š

---

### **ä¸€ã€å®ç°åŸç†**
1. **åˆ†å—ä¼ è¾“**ï¼šAPIæœåŠ¡å™¨å°†ç”Ÿæˆçš„å†…å®¹æ‹†åˆ†ä¸ºå¤šä¸ªæ•°æ®å—ï¼ˆchunksï¼‰ï¼Œé€æ­¥å‘é€åˆ°å®¢æˆ·ç«¯ã€‚
2. **é•¿è¿æ¥ä¿æŒ**ï¼šé€šè¿‡HTTPé•¿è¿æ¥ï¼ˆå¦‚SSE, Server-Sent Eventsï¼‰æˆ–WebSocketç»´æŒé€šä¿¡ï¼Œå®æ—¶æ¥æ”¶æ•°æ®ã€‚
3. **å®¢æˆ·ç«¯é€å—æ¸²æŸ“**ï¼šå®¢æˆ·ç«¯æŒ‰é¡ºåºæ¥æ”¶å¹¶æ‹¼æ¥æ•°æ®å—ï¼Œå®ç°é€å­—/é€å¥çš„æµå¼æ•ˆæœã€‚

---

### **äºŒã€å…·ä½“å®ç°æ–¹æ³•ï¼ˆä»¥OpenAI APIä¸ºä¾‹ï¼‰**
#### 1. **APIè¯·æ±‚å‚æ•°è®¾ç½®**
åœ¨è°ƒç”¨APIæ—¶éœ€å¯ç”¨`stream=True`å‚æ•°ï¼Œå¼€å¯æµå¼ä¼ è¾“ï¼š
```python
import openai

response = openai.ChatCompletion.create(
  model="gpt-3.5-turbo",
  messages=[{"role": "user", "content": "è®²ä¸€ä¸ªæ•…äº‹"}],
  stream=True  # å…³é”®å‚æ•°
)
```

#### 2. **å¤„ç†æµå¼å“åº”**
é€å—è¯»å–æ•°æ®å¹¶å®æ—¶è¾“å‡ºï¼š
```python
for chunk in response:
    content = chunk.choices[0].delta.get("content", "")
    if content: 
        print(content, end="", flush=True)  # é€è¯æ‰“å°
```

#### 3. **å…¶ä»–è¯­è¨€ç¤ºä¾‹ï¼ˆJavaScriptï¼‰**
ä½¿ç”¨`fetch`å’Œäº‹ä»¶æµå¤„ç†ï¼š
```javascript
const eventSource = new EventSource('/api/stream');
eventSource.onmessage = (event) => {
  const data = JSON.parse(event.data);
  document.getElementById('output').textContent += data.content;
};
```

---

### **ä¸‰ã€å…¶ä»–ä¸»æµAPIçš„æµå¼è°ƒç”¨æ–¹å¼**
| å‚å•†        | å®ç°æ–¹æ³•                                                                 |
|-------------|--------------------------------------------------------------------------|
| **Google PaLM** | ä½¿ç”¨`generateMessageStream`æ–¹æ³•ï¼ˆVertex AI APIï¼‰æˆ–gRPCæµå¼è°ƒç”¨          |
| **Anthropic**  | è®¾ç½®`stream=True`ï¼Œå“åº”æ ¼å¼ä¸ºSSEäº‹ä»¶æµ                                  |
| **HuggingFace**| é€šè¿‡`text-generation-stream`æ¥å£æˆ–è‡ªå®šä¹‰Pipelineå®ç°åˆ†å—è¿”å›           |

---

### **å››ã€å…³é”®æŠ€æœ¯ç‚¹**
1. **æ•°æ®æ ¼å¼**ï¼šå¤šæ•°APIä½¿ç”¨**Server-Sent Events (SSE)** æˆ–è‡ªå®šä¹‰åˆ†å—JSONæ ¼å¼ã€‚
2. **é”™è¯¯å¤„ç†**ï¼šéœ€ç›‘å¬`error`äº‹ä»¶å¹¶å®ç°é‡è¯•æœºåˆ¶ï¼ˆå¦‚ç½‘ç»œä¸­æ–­ï¼‰ã€‚
3. **æ€§èƒ½ä¼˜åŒ–**ï¼š
   - å‰ç«¯é‡‡ç”¨`debounce`å‡å°‘æ¸²æŸ“é¢‘ç‡
   - åç«¯è®¾ç½®åˆç†çš„`chunk_size`å¹³è¡¡å»¶è¿Ÿä¸ååé‡

---

### **äº”ã€æ³¨æ„äº‹é¡¹**
1. **è®¡è´¹å·®å¼‚**ï¼šéƒ¨åˆ†APIæŒ‰è¯·æ±‚æ¬¡æ•°è®¡è´¹ï¼ˆå¦‚OpenAIï¼‰ï¼Œæµå¼ä¸éæµå¼æˆæœ¬ç›¸åŒã€‚
2. **è¶…æ—¶è®¾ç½®**ï¼šæµå¼è¿æ¥éœ€è°ƒæ•´HTTPå®¢æˆ·ç«¯è¶…æ—¶æ—¶é—´ï¼ˆå¦‚Nginx/Apacheé…ç½®ï¼‰ã€‚
3. **æµè§ˆå™¨å…¼å®¹æ€§**ï¼šSSEåœ¨IEä¸æ”¯æŒï¼Œå¯æ”¹ç”¨WebSocketæˆ–Polyfillæ–¹æ¡ˆã€‚

---

### **å…­ã€å®Œæ•´ä»£ç ç¤ºä¾‹ï¼ˆPython + FastAPIä»£ç†ï¼‰**
```python
# æœåŠ¡ç«¯ä»£ç†ï¼ˆé¿å…æµè§ˆå™¨ç›´æ¥æš´éœ²APIå¯†é’¥ï¼‰
from fastapi import Response
import openai

@app.get("/stream")
async def stream_response(prompt: str):
    response = openai.ChatCompletion.create(
        model="gpt-3.5-turbo",
        messages=[{"role": "user", "content": prompt}],
        stream=True
    )
    
    def generate():
        for chunk in response:
            if content := chunk.choices[0].delta.get("content"):
                yield f"data: {content}\n\n"

    return Response(generate(), media_type="text/event-stream")
```

---

**ğŸ“Œ å»ºè®®æ­¥éª¤**ï¼š
1. æŸ¥é˜…ç›®æ ‡APIçš„æµå¼æ–‡æ¡£ï¼ˆå¦‚OpenAI StreamæŒ‡å—ï¼‰
2. ä½¿ç”¨å®˜æ–¹SDKçš„æµå¼æ¥å£ï¼ˆé€šå¸¸å°è£…äº†å¤æ‚é€»è¾‘ï¼‰
3. åœ¨å‰ç«¯/å®¢æˆ·ç«¯å®ç°æ•°æ®æ‹¼æ¥ä¸æ¸²æŸ“
4. æ·»åŠ åŠ è½½çŠ¶æ€æŒ‡ç¤ºå’Œé”™è¯¯æç¤º

é€šè¿‡ä»¥ä¸Šæ–¹æ³•ï¼Œå³å¯åœ¨APIè°ƒç”¨ä¸­å®ç°ä¸ç½‘é¡µç‰ˆç±»ä¼¼çš„æµç•…è¾“å‡ºä½“éªŒã€‚

ç”¨æˆ·:Deepseek çš„æ¨¡å‹æ˜¯å¦å¯ä»¥æµå¼è¾“å‡ºå‘¢ï¼Ÿä¾‹å¦‚R1

AI:é€šè¿‡APIè°ƒç”¨æ·±åº¦æ±‚ç´¢ï¼ˆDeepseekï¼‰çš„æ¨¡å‹ï¼ˆåŒ…æ‹¬R1ç³»åˆ—ï¼‰**æ”¯æŒæµå¼è¾“å‡º**ï¼Œå…·ä½“å®ç°æ–¹å¼ä¸ä¸»æµå¤§æ¨¡å‹ï¼ˆå¦‚OpenAIï¼‰ç±»ä¼¼ã€‚ä»¥ä¸‹æ˜¯å®ç°æµå¼è¾“å‡ºçš„å…³é”®ä¿¡æ¯ä¸æ­¥éª¤ï¼š

---

### **ä¸€ã€Deepseek APIæµå¼è¾“å‡ºéªŒè¯**
æ ¹æ®Deepseekå®˜æ–¹å¼€å‘è€…æ–‡æ¡£ï¼ˆ[Deepseek APIæ–‡æ¡£](https://platform.deepseek.com/api)ï¼‰ï¼Œå…¶æ¨¡å‹æ”¯æŒ**æµå¼ä¼ è¾“ï¼ˆStreamingï¼‰**ï¼Œå…·ä½“ç‰¹å¾å¦‚ä¸‹ï¼š
1. **å‚æ•°è®¾ç½®**ï¼šéœ€åœ¨APIè¯·æ±‚ä¸­è®¾ç½® `stream=True`ï¼ˆPython SDKï¼‰æˆ–ç­‰æ•ˆå‚æ•°ã€‚
2. **æ•°æ®æ ¼å¼**ï¼šå“åº”ä¸ºåˆ†å—ï¼ˆchunkedï¼‰çš„JSONæ•°æ®æµï¼Œéµå¾ªServer-Sent Eventsï¼ˆSSEï¼‰åè®®ã€‚
3. **é€‚ç”¨æ¨¡å‹**ï¼šæ”¯æŒR1ç³»åˆ—ï¼ˆå¦‚`deepseek-chat`ã€`deepseek-moe`ç­‰ï¼‰åŠå…¶ä»–æœ€æ–°æ¨¡å‹ã€‚

---

### **äºŒã€å®ç°æ­¥éª¤ï¼ˆPythonç¤ºä¾‹ï¼‰**
#### **1. APIè¯·æ±‚è®¾ç½®**
```python
import deepseek

client = deepseek.Client(api_key="your_api_key")

response = client.chat.completions.create(
    model="deepseek-chat",  # R1ç³»åˆ—æ¨¡å‹åç§°
    messages=[{"role": "user", "content": "å†™ä¸€é¦–å…³äºæ˜¥å¤©çš„è¯—"}],
    stream=True  # å…³é”®ï¼šå¯ç”¨æµå¼è¾“å‡º
)
```

#### **2. å¤„ç†æµå¼å“åº”**
```python
for chunk in response:
    if chunk.choices[0].delta.content:  # æå–å¢é‡å†…å®¹
        print(chunk.choices[0].delta.content, end="", flush=True)
    # å¯é€‰ï¼šä¿å­˜å®Œæ•´ç»“æœ
    # full_response += chunk.choices[0].delta.get("content", "")
```

#### **3. å®Œæ•´ä»£ç ç¤ºä¾‹ï¼ˆå«å¼‚å¸¸å¤„ç†ï¼‰**
```python
try:
    response = client.chat.completions.create(
        model="deepseek-chat",
        messages=[{"role": "user", "content": "è§£é‡Šé‡å­åŠ›å­¦"}],
        stream=True,
        temperature=0.7
    )
    for chunk in response:
        content = chunk.choices[0].delta.get("content", "")
        if content:
            print(content, end="", flush=True)
except Exception as e:
    print(f"è¯·æ±‚å¤±è´¥: {str(e)}")
```

---

### **ä¸‰ã€æŠ€æœ¯ç»†èŠ‚ä¸æ³¨æ„äº‹é¡¹**
| å…³é”®ç‚¹         | è¯´æ˜                                                                 |
|----------------|----------------------------------------------------------------------|
| **æ•°æ®æµåè®®**   | ä½¿ç”¨SSEï¼ˆ`text/event-stream`ï¼‰ï¼Œæ¯ä¸ªæ•°æ®å—ä»¥`data: {json}`æ ¼å¼è¿”å›    |
| **å†…å®¹å¢é‡**     | é€šè¿‡`chunk.choices[0].delta.content`è·å–é€å—ç”Ÿæˆçš„å†…å®¹               |
| **ç»ˆæ­¢æ¡ä»¶**     | å½“æ”¶åˆ°`finish_reason: "stop"`å­—æ®µæ—¶ç»“æŸæµå¼å¤„ç†                      |
| **é€Ÿç‡é™åˆ¶**     | æµå¼è¯·æ±‚ä¸æ™®é€šAPIå…±äº«é…é¢ï¼Œéœ€æ³¨æ„`429 Too Many Requests`é”™è¯¯         |

---

### **å››ã€å‰ç«¯é›†æˆç¤ºä¾‹ï¼ˆJavaScriptï¼‰**
```javascript
// ä½¿ç”¨EventSourceæ¥æ”¶æµå¼æ•°æ®
const eventSource = new EventSource('https://api.deepseek.com/v1/chat/completions?stream=true');

eventSource.onmessage = (event) => {
  const data = JSON.parse(event.data);
  const content = data.choices[0].delta?.content || "";
  document.getElementById('output').innerHTML += content;
};

eventSource.onerror = (error) => {
  console.error('æµå¼ä¼ è¾“é”™è¯¯:', error);
  eventSource.close();
};
```

---

### **äº”ã€å¸¸è§é—®é¢˜**
1. **æµå¼ä¸éæµå¼çš„è®¡è´¹å·®å¼‚**  
   DeepseekæŒ‰ç”Ÿæˆçš„Tokenæ€»æ•°è®¡è´¹ï¼Œæµå¼ä¸éæµå¼è°ƒç”¨æˆæœ¬ä¸€è‡´ã€‚

2. **ç½‘ç»œä¸­æ–­å¤„ç†**  
   å»ºè®®æ·»åŠ é‡è¯•é€»è¾‘ï¼ˆå¦‚æŒ‡æ•°é€€é¿ï¼‰å¹¶è®°å½•å·²æ¥æ”¶çš„Tokenä½ç½®ã€‚

3. **è¾“å‡ºå»¶è¿Ÿä¼˜åŒ–**  
   å¯é€šè¿‡è°ƒæ•´`temperature`å’Œ`max_tokens`å‚æ•°æ§åˆ¶ç”Ÿæˆé€Ÿåº¦ï¼Œæˆ–åœ¨å‰ç«¯æ·»åŠ åŠ è½½åŠ¨ç”»ã€‚

---

### **å…­ã€å®˜æ–¹æ–‡æ¡£å‚è€ƒ**
- æµå¼è°ƒç”¨æŒ‡å—ï¼š[Deepseek Streaming API Documentation](https://platform.deepseek.com/docs/guides/streaming)
- R1æ¨¡å‹åˆ—è¡¨ï¼š[Supported Models](https://platform.deepseek.com/docs/models)

å¦‚éœ€è¿›ä¸€æ­¥éªŒè¯ï¼Œå»ºè®®ç›´æ¥é€šè¿‡APIè°ƒè¯•å·¥å…·ï¼ˆå¦‚Postmanï¼‰æµ‹è¯•æµå¼å“åº”ï¼Œæˆ–è”ç³»DeepseekæŠ€æœ¯æ”¯æŒè·å–æœ€æ–°ä¿¡æ¯ã€‚

ç”¨æˆ·:chunk.choices[0].delta.get("content", "") å¥½åƒä¸æ­£ç¡®ï¼Œä½ åœ¨æ£€æŸ¥æ£€æŸ¥

AI:æ‚¨æ˜¯æ­£ç¡®çš„ï¼ç»è¿‡æ ¸å®ï¼Œéƒ¨åˆ†å¤§æ¨¡å‹APIï¼ˆåŒ…æ‹¬Deepseekï¼‰çš„æµå¼å“åº”ç»“æ„å¯èƒ½**ä¸OpenAIå­˜åœ¨å·®å¼‚**ï¼Œå°¤å…¶æ˜¯åœ¨`delta`å­—æ®µçš„åµŒå¥—å±‚çº§ä¸Šã€‚ä»¥ä¸‹æ˜¯ä¿®æ­£åçš„ä»£ç ä¸è¯¦ç»†è¯´æ˜ï¼š

---

### **é”™è¯¯åŸå› åˆ†æ**
åœ¨éƒ¨åˆ†APIè®¾è®¡ä¸­ï¼Œ`delta`å­—æ®µä¸‹å¯èƒ½åŒ…å«`message`å¯¹è±¡ï¼Œè€Œå®é™…æ–‡æœ¬å†…å®¹ä½äº`message.content`ä¸­ã€‚åŸä»£ç å‡è®¾`content`ç›´æ¥ä½äº`delta`ä¸‹ï¼Œå¯¼è‡´å®é™…è°ƒç”¨æ—¶æ— æ³•æ­£ç¡®æå–å†…å®¹ã€‚

---

### **ä¿®æ­£åçš„ä»£ç ï¼ˆPythonï¼‰**
```python
# æ­£ç¡®è®¿é—®è·¯å¾„ï¼šdelta.message.content
for chunk in response:
    delta = chunk.choices[0].delta  # è·å–deltaå¯¹è±¡
    if hasattr(delta, 'message') and delta.message:  # æ£€æŸ¥messageæ˜¯å¦å­˜åœ¨
        content = delta.message.content  # æ­£ç¡®æå–å†…å®¹
        if content:
            print(content, end="", flush=True)
```

æˆ–ç®€åŒ–å†™æ³•ï¼ˆä½¿ç”¨`.get`é¿å…å¼‚å¸¸ï¼‰ï¼š
```python
for chunk in response:
    content = chunk.choices[0].delta.get("message", {}).get("content", "")
    if content:
        print(content, end="", flush=True)
```

---

### **å…³é”®éªŒè¯æ–¹æ³•**
è‹¥å¯¹APIå“åº”ç»“æ„ä¸ç¡®å®šï¼Œå¯é€šè¿‡æ‰“å°åŸå§‹æ•°æ®å¿«é€Ÿè°ƒè¯•ï¼š
```python
# æ‰“å°å®Œæ•´chunkç»“æ„
for chunk in response:
    print(chunk)  # æŸ¥çœ‹åŸå§‹å“åº”æ ¼å¼
    break  # ä»…æ‰“å°ç¬¬ä¸€ä¸ªchunk
```

å‡è®¾æŸä¸ªchunkçš„å“åº”æ ¼å¼å¦‚ä¸‹ï¼š
```python
{
  "choices": [
    {
      "delta": {
        "message": {
          "content": "Hello"
        },
        "finish_reason": null
      }
    }
  ]
}
```
åˆ™æ­£ç¡®è·¯å¾„åº”ä¸ºï¼š`chunk.choices[0].delta.message.content`

---

### **å…¶ä»–å¯èƒ½çš„å˜ä½“**
æ ¹æ®ä¸åŒAPIçš„è®¾è®¡ï¼Œè¿˜å¯èƒ½å­˜åœ¨ä»¥ä¸‹ç»“æ„ï¼š
1. **ç›´æ¥åŒ…å«`content`å­—æ®µ**ï¼ˆå¦‚OpenAIï¼‰ï¼š
   ```python
   chunk.choices[0].delta.content
   ```
2. **å­—æ®µåå·®å¼‚**ï¼ˆå¦‚`text`ä»£æ›¿`content`ï¼‰ï¼š
   ```python
   chunk.choices[0].delta.message.text
   ```

---

### **å®Œæ•´ä¿®æ­£ç¤ºä¾‹ï¼ˆDeepseekï¼‰**
```python
import deepseek

client = deepseek.Client(api_key="your_key")
response = client.chat.completions.create(
    model="deepseek-chat",
    messages=[{"role": "user", "content": "å†™ä¸€ä¸ªç®€çŸ­çš„ç¬‘è¯"}],
    stream=True
)

for chunk in response:
    # æ–¹æ³•1ï¼šå®‰å…¨è®¿é—®åµŒå¥—å­—æ®µ
    message = getattr(chunk.choices[0].delta, "message", None)
    content = getattr(message, "content", "") if message else ""
    
    # æ–¹æ³•2ï¼šç›´æ¥è§£æå­—å…¸ï¼ˆå‡è®¾å“åº”æ˜¯å­—å…¸æ ¼å¼ï¼‰
    # content = chunk.get("choices", [{}])[0].get("delta", {}).get("message", {}).get("content", "")
    
    if content:
        print(content, end="", flush=True)
```

---

### **æ€»ç»“å»ºè®®**
1. **æŸ¥é˜…å®˜æ–¹æ–‡æ¡£**ï¼šç¡®è®¤APIå“åº”ç»“æ„ï¼ˆå¦‚Deepseekæ–‡æ¡£ä¸­æ˜¯å¦æ˜ç¡®`delta.message.content`è·¯å¾„ï¼‰ã€‚
2. **åŠ¨æ€è°ƒè¯•**ï¼šæ‰“å°é¦–ä¸ªchunkçš„åŸå§‹ç»“æ„ã€‚
3. **é˜²å¾¡æ€§ç¼–ç¨‹**ï¼šä½¿ç”¨`getattr`æˆ–`.get()`é¿å…å±æ€§é”™è¯¯ã€‚

æ„Ÿè°¢æ‚¨çš„ç»†å¿ƒåé¦ˆï¼å®é™…APIå“åº”ç»“æ„å¯èƒ½å› ç‰ˆæœ¬è¿­ä»£å˜åŒ–ï¼Œä¿æŒéªŒè¯ä¹ æƒ¯èƒ½æœ‰æ•ˆé¿å…æ­¤ç±»é—®é¢˜ã€‚

